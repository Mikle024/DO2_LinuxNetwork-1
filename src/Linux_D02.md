# Linux_D02:

----------------------------------------------------------------------------

- [Linux\_D02:](#linux_d02)
    - [1. Инструмент ipcalc:](#1-инструмент-ipcalc)
    - [2. Статическая маршрутизация между двумя машинами:](#2-статическая-маршрутизация-между-двумя-машинами)
    - [3. Утилита iperf3:](#3-утилита-iperf3)
    - [4. Сетевой экран:](#4-сетевой-экран)
    - [5. Статическая маршрутизация сети:](#5-статическая-маршрутизация-сети)
    - [6. Динамическая настройка IP с помощью DHCP:](#6-динамическая-настройка-ip-с-помощью-dhcp)
    - [7. NAT:](#7-nat)
    - [8. Знакомство с SSH Tunnels:](#8-знакомство-с-ssh-tunnels)

----------------------------------------------------------------------------

## 1. Инструмент ipcalc:
- Поднял vm на **Ubuntu 24.04.6 LTS** с *hostname* **ws1**  и выполнил команду `cat /etc/issue`, что бы проверить версию.

> Вывод файла /etc/issue
>
> ![Вывод файла /etc/issue](screen%2Fscreen_1_01.png)
>

- Выполнил команду от имени администратора `sudo` `apt install ipcalc`, что бы скачать утилиту ipcalc.
- Подтвердил действие паролем администратора.

> Установка ipcalc
>
> ![Установка ipcalc](screen%2Fscreen_1_02.png)
>

**1.1 Сети и маски:**
- Выполнил команду `ipcalc 192.167.38.54/13`.

> Вывод команды ipcalc 192.167.38.54/13
>
> ![Вывод команды ipcalc 192.167.38.54/13](screen%2Fscreen_1_03.png)
>

- 192.167.38.54/13:
  - Адрес сети: 192.160.0.0


- Выполнил команду `ipcalc 255.255.255.0`.

> Вывод команды ipcalc 255.255.255.0
>
> ![Вывод команды ipcalc 255.255.255.0](screen%2Fscreen_1_04.png)
>

- 255.255.255.0:
  - Префиксная запись: /24
  - Двоичная запись: 11111111.11111111.11111111.00000000


- Выполнил команду `ipcalc 0.0.0.0/15`.

> Вывод команды ipcalc 0.0.0.0/15
>
> ![Вывод команды ipcalc 0.0.0.0/15](screen%2Fscreen_1_05.png)
>

- 255.255.255.0:
  - Обычная запись: 255.254.0.0
  - Двоичная запись: 11111111.11111110.00000000.00000000


- Маска 11111111.11111111.11111111.11110000 содержит 28 единиц, поэтому префиксная запись выглядит как /28.


- Выполнил команду `ipcalc 0.0.0.0/28`.

> Вывод команды ipcalc 0.0.0.0/28
>
> ![Вывод команды ipcalc 0.0.0.0/28](screen%2Fscreen_1_06.png)
>

- 11111111.11111111.11111111.11110000:
  - Префиксная запись: /28
  - Обычная запись: 255.255.255.240


- Выполнил команду `ipcalc 12.167.38.4/8`.

> Вывод команды ipcalc 12.167.38.4/8
>
> ![Вывод команды ipcalc 12.167.38.4/8](screen%2Fscreen_1_07.png)
>

- Сеть 12.167.38.4 с маской /8:
  - Минимальный хост: 12.0.0.1
  - Максимальный хост: 12.255.255.254


- Маска 11111111.11111111.00000000.00000000 содержит 16 единиц, поэтому префиксная запись выглядит как /16.


- Выполнил команду `ipcalc 12.167.38.4/16`.

> Вывод команды ipcalc 0.0.0.0/16
>
> ![Вывод команды ipcalc 0.0.0.0/16](screen%2Fscreen_1_08.png)
>

- Сеть 12.167.38.4 с маской /16:
  - Минимальный хост: 12.167.0.1
  - Максимальный хост: 12.167.255.254


- Выполнил команду `ipcalc 12.167.38.4/255.255.254.0`.

> Вывод команды ipcalc 0.0.0.0/255.255.254.0
>
> ![Вывод команды ipcalc 0.0.0.0/255.255.254.0](screen%2Fscreen_1_09.png)
>

- Сеть 12.167.38.4 с маской /255.255.254.0:
  - Минимальный хост: 12.167.38.1
  - Максимальный хост: 12.167.39.254


- Выполнил команду `ipcalc 12.167.38.4/4`.

> Вывод команды ipcalc 0.0.0.0/4
>
> ![Вывод команды ipcalc 0.0.0.0/4](screen%2Fscreen_1_10.png)
>

- Сеть 12.167.38.4 с маской 4:
  - Минимальный хост: 0.0.0.1
  - Максимальный хост: 15.255.255.254

**1.2. localhost:**

*Диапазон адресов 127.0.0.0/8 называется диапазоном адресов внутреннего хоста (Internal host loopback). IPv4-адреса такой формы используются для обращения к самому хосту. Если вы запросите любой из этих адресов на любом сетевом устройстве, вы должны получить ответ.*

**Статья в [Wikipedia](https://en.wikipedia.org/wiki/Localhost)**.

- Выполнил команду `ipcalc 127.0.0.0/8`.

> Вывод команды ipcalc 127.0.0.0/8
>
> ![Вывод команды ipcalc 127.0.0.0/8](screen%2Fscreen_1_11.png)
>

- Диапазон сети 127.0.0.0/8:
  - Минимальный хост: 127.0.0.1
  - Максимальный хост: 127.255.255.254

| Адрес | Диапазон                          | Приложение на localhost  с данным ip                    |
| -------- |-----------------------------------|---------------------------------------------------------|
| 194.34.23.100:    | Адрес не в диапазоне 127.0.0.0/8. | Нельзя обратиться к приложению на localhost с этого IP. |
| 127.0.0.2:     | Адрес из диапазона 127.0.0.0/8.   | Можно обратиться к приложению на localhost с этого IP.  |
| 127.1.0.1:    | Адрес из диапазона 127.0.0.0/8.   | Можно обратиться к приложению на localhost с этого IP.  |
| 128.0.0.1:    | Адрес не в диапазоне 127.0.0.0/8. | Нельзя обратиться к приложению на localhost с этого IP. |

**1.3. Диапазоны и сегменты сетей:**

*Частные внутренние адреса не маршрутизируются в Интернете и на них нельзя отправить трафик из Интернета, они работают только в пределах локальной сети.*

- *К частным "серым" адресам относятся IP-адреса из следующих подсетей:*
  - От 10.0.0.0 до 10.255.255.255 с маской 255.0.0.0 или /8 
    - **10.0.0.0/8**
  - От 172.16.0.0 до 172.31.255.255 с маской 255.240.0.0 или /12 
    - **172.16.0.0/12**
  - 192.168.0.0 до 192.168.255.255 с маской 255.255.0.0 или /16 
    - **192.168.0.0/16**


- Выполнил команду `ipcalc 10.0.0.0/8`, что бы узнать диапазон сети.

> Вывод команды ipcalc 10.0.0.0/8
>
> ![Вывод команды ipcalc 10.0.0.0/8](screen%2Fscreen_1_12.png)
>

- Диапазон сети 10.0.0.0/8:
  - Минимальный хост: 10.0.0.1
  - Максимальный хост: 10.255.255.254

- Выполнил команду `ipcalc 172.16.0.0/12`, что бы узнать диапазон сети.

> Вывод команды ipcalc 172.16.0.0/12
>
> ![Вывод команды ipcalc 172.16.0.0/12](screen%2Fscreen_1_13.png)
>

- Диапазон сети 172.16.0.0/12:
  - Минимальный хост: 172.16.0.1
  - Максимальный хост: 172.31.255.254

- Выполнил команду `ipcalc 192.168.0.0/16`, что бы узнать диапазон сети.

> Вывод команды ipcalc 192.168.0.0/16
>
> ![Вывод команды ipcalc 192.168.0.0/16](screen%2Fscreen_1_14.png)
>

- Диапазон сети 192.168.0.0/16:
  - Минимальный хост: 192.168.0.1
  - Максимальный хост: 192.168.255.254

Адреса **10.0.0.45**, **192.168.4.2**, **172.20.250.4**, **172.16.255.255** и **10.10.10.10** входят в диапазоны проверенных сетей, следовательно, они являются частными адресами.

Адреса **134.43.0.2**, **172.0.2.1**, **192.172.0.1**, **172.68.0.2** и **192.169.168.1** находятся вне этих диапазонов, значит их можно использовать качестве публичных адресов.

- Выполнил команду `ipcalc 10.10.0.0/18`, что бы узнать диапазон сети.

> Вывод команды ipcalc 10.10.0.0/18
>
> ![Вывод команды ipcalc 10.10.0.0/18](screen%2Fscreen_1_15.png)
>

- Диапазон сети 10.10.0.0/18:
  - Минимальный хост: 10.10.0.1
  - Максимальный хост: 10.10.63.254

*Адрес шлюза сети должен входить в диапазон HostMin - HostMax.*
- Возможные адреса шлюза у сети **10.10.0.0/18**:
  - **10.10.0.2**
  - **10.10.10.10**
  - **10.10.1.255**

Адреса **10.0.0.1** и **10.10.100.1** не входят в указанный диапазон, и не могут являться шлюзом этой сети.

----------------------------------------------------------------------------

## 2. Статическая маршрутизация между двумя машинами:
- Поднял вторую vm с *hostname* **ws2**.

> Вывод файла /etc/issue
>
> ![Вывод файла /etc/issue](screen%2Fscreen_2_01.png)
>

- Выполнил команду `ip a`, что бы посмотреть существующие сетевые интерфейсы на ws1.

> Вывод команды ip a (ws1)
>
> ![Вывод команды ip a ws1](screen%2Fscreen_2_02.png)
>

**2.1. Сетевые интерфейсы:**

- **Интерфейсы на ws1:**

  - lo (Loopback Interface):

| Состояние:    | UP. | 
|---------------|-----------------------------------|
| MTU:          | 65536.   | 
| Адрес (IPv4): | 127.0.0.1/8.   | 
| Адрес (IPv6):       | ::1/128. |

  - enp0s3 (Ethernet Interface):

| Состояние:    | UP. | 
|---------------|-----------------------------------|
| MTU:          | 1500.   | 
| MAC-адрес:          | 08:00:27:30:2c:1a.   | 
| Адрес (IPv4): | 10.0.2.15/24.   | 
| Адрес (IPv6):       | fe80::a00:27ff:fe30:2c1a/64. |

- Выполнил команду `ip a` на ws2.

> Вывод команды ip a (ws2)
>
> ![Вывод команды ip a ws2](screen%2Fscreen_2_03.png)
>

- **Интерфейсы на ws2:**

  - lo (Loopback Interface):

|  Состояние:             | UP.                          | 
|---------------|-----------------------------------|
| MTU:  | 65536. | 
| Адрес (IPv4): | 127.0.0.1/8.   | 
| Адрес (IPv6): | ::1/128.   |

  - enp0s3 (Ethernet Interface):

| Состояние:    | UP. | 
|---------------|-----------------------------------|
| MTU:          | 1500.   | 
| MAC-адрес:          | 08:00:27:58:27:34.   | 
| Адрес (IPv4): | 10.0.2.15/24.   | 
| Адрес (IPv6):       | fe80::a00:27ff:fe58:2734/64. |

*Что бы добавить ещё один интерфейс, соответсвующий внутренней сети, нужно добавить настройки в **Virtual Box**.*

- Открыл интерфейс **Virtual Box**.
- Зашел в настройки сети машины **ws1**, и добавил еще один интерфейс с типом подключения **внутренняя сеть**.

> Добавление нового интерфейса в VB ws1:
>
> ![Добавление нового интерфейса в VB ws1:(1)](screen%2Fscreen_2_04.png)
> ![Добавление нового интерфейса VB ws1:(2)](screen%2Fscreen_2_05.png)
> ![Добавление нового интерфейса VB ws1:(3)](screen%2Fscreen_2_06.png)
>

- То же самое сделал для второй машины **ws2**.

> Добавление нового интерфейса в VB ws2:
>
> ![Добавление нового интерфейса в VB ws2](screen%2Fscreen_2_07.png)
>

- Выполнил команду `ip a` на ws1, что бы убедиться, что интерфейс добавился.

> Вывод команды ip a (ws1)
>
> ![Вывод команды ip a ws1](screen%2Fscreen_2_08.png)
>
- **Интерфейс, соответсвующий внутренней сети:**
  - enp0s8 (intnet Interface):

| Состояние:    | UP.                | 
|---------------|--------------------|
| MTU:          | 1500.              | 
| MAC-адрес:          | 08:00:27:c0:3b:6e. |

- Выполнил команду `ip a` на ws2.

> Вывод команды ip a (ws2)
>
> ![Вывод команды ip a ws2](screen%2Fscreen_2_09.png)
>

- **Интерфейс, соответсвующий внутренней сети:**
  - enp0s8 (intnet Interface):

| Состояние:    | UP.                | 
|---------------|--------------------|
| MTU:          | 1500.              | 
| MAC-адрес:          | 08:00:27:6c:8c:41. |

**Настраиваем сетевые интерфейсы, с заданными адресами и масками:**

- Изменил файл конфигурации *netplan* на **ws1** командой от имени администратора `sudo` `vim /etc/netplan/00-installer-config.yaml`.

> Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws1)
>
> ![Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws1)](screen%2Fscreen_2_10.png)
>

```yaml
network: # Основной раздел, который описывает конфигурацию сети
  ethernets: # Раздел, в котором перечислены сетевые интерфейсы
    enp0s3: # Интерфейс с типом подключения NAT
      dhcp4: true # Включение DHCP для данного интерфейса (динамическая настройка IP).
    enp0s8: # Интерфейс с типом подключения внутренняя сеть
      dhcp4: false # Отключение DHCP для данного интерфейса (статическая настройка IP).
      addresses: [192.168.100.10/16] # Статический IP-адрес для интерфейса enp0s8 с маской сети /16 (255.255.0.0).
  version: 2 # Версия схемы Netplan
```

- Изменил файл конфигурации *netplan* на **ws2** командой от имени администратора `sudo` `vim /etc/netplan/00-installer-config.yaml`.

> Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws2)
>
> ![Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws2)](screen%2Fscreen_2_11.png)
>

```yaml
network: # Основной раздел, который описывает конфигурацию сети
  ethernets: # Раздел, в котором перечислены сетевые интерфейсы
    enp0s3: # Интерфейс с типом подключения NAT
      dhcp4: true # Включение DHCP для данного интерфейса (динамическая настройка IP).
    enp0s8: # Интерфейс с типом подключения внутренняя сеть
      dhcp4: false # Отключение DHCP для данного интерфейса (статическая настройка IP).
      addresses: [172.24.116.8/12] # Статический IP-адрес для интерфейса enp0s8 с маской сети /12 (255.240.0.0).
  version: 2 # Версия схемы Netplan
```

- Выполнил команду от имени администратора `sudo` `netplan apply`, что бы применить настройки на двух машинах.

> Применение настроек сети (ws1)
>
> ![Применение настроек сети (ws1)](screen%2Fscreen_2_12.png)
>

> Применение настроек сети (ws2)
>
> ![Применение настроек сети (ws2)](screen%2Fscreen_2_13.png)
>

**2.1. Добавление статического маршрута вручную:**
- Выполнил команду от имени администратора `sudo` `ip route add 172.24.116.8 dev enp0s3` на ws1.

> Добавляем статический маршрут от ws1 до ws2
>
> ![Добавляем статический маршрут от ws1 до ws2](screen%2Fscreen_2_14.png)
>

- Выполнил команду от имени администратора `sudo` `ip route add 192.168.100.10 dev enp0s3` на ws2.

> Добавляем статический маршрут от ws2 до ws1
>
> ![Добавляем статический маршрут от ws2 до ws1](screen%2Fscreen_2_15.png)
>

- Пропинговал ws2 с ws1, командой `ping -c 3 172.24.116.8`, указав отправку 3 пакетов.

> Успешно пропингованный ip 172.24.116.8
>
> ![Успешно пропингованный ip 172.24.116.8](screen%2Fscreen_2_16.png)
>

- Пропинговал ws1 с ws2, командой `ping -c 3 192.168.100.10`, указав отправку 3 пакетов.

> Успешно пропингованный ip 192.168.100.10
>
> ![Успешно пропингованный ip 192.168.100.10](screen%2Fscreen_2_17.png)
>

**2.1. Добавление статического маршрута с сохранением:**

- Перезапустил обе машины командой от имени администратора `sudo` `reboot`.
- Изменил файл конфигурации *netplan* на **ws1** командой от имени администратора `sudo` `vim /etc/netplan/00-installer-config.yaml`.

> Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws1)
>
> ![Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws1)](screen%2Fscreen_2_18.png)
>

```yaml
network: # Основной раздел, который описывает конфигурацию сети
  ethernets: # Раздел, в котором перечислены сетевые интерфейсы
    enp0s3: # Интерфейс с типом подключения NAT
      dhcp4: true # Включение DHCP для данного интерфейса (динамическая настройка IP).
    enp0s8: # Интерфейс с типом подключения внутренняя сеть
      dhcp4: false # Отключение DHCP для данного интерфейса (статическая настройка IP).
      addresses: [192.168.100.10/16] # Статический IP-адрес для интерфейса enp0s8 с маской сети /16 (255.255.0.0).
      routes: # Раздел для статических маршрутов
        - to: 172.24.116.8 # IP-адрес назначения для маршрута
          via: 192.168.100.10   # IP-адрес шлюза для маршрута (в данном случае это тот же IP, что и адрес интерфейса)
  version: 2 # Версия схемы Netplan
```

- Изменил файл конфигурации *netplan* на **ws2** командой от имени администратора `sudo` `vim /etc/netplan/00-installer-config.yaml`.

> Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws2)
>
> ![Измененный файл конфигурации /etc/netplan/00-installer-config.yaml (ws2)](screen%2Fscreen_2_19.png)
>

```yaml
network: # Основной раздел, который описывает конфигурацию сети
  ethernets: # Раздел, в котором перечислены сетевые интерфейсы
    enp0s3: # Интерфейс с типом подключения NAT
      dhcp4: true # Включение DHCP для данного интерфейса (динамическая настройка IP)
    enp0s8: # Интерфейс с типом подключения внутренняя сеть
      dhcp4: false # Отключение DHCP для данного интерфейса (статическая настройка IP).
      addresses: [172.24.116.8/12] # Статический IP-адрес для интерфейса enp0s3 с маской сети /12 (255.240.0.0).
      routes: # Настройка маршрута по умолчанию (default route).
        - to: 192.168.100.10 # Раздел для статических маршрутов
          via: 172.24.116.8 # IP-адрес шлюза для маршрута (в данном случае это тот же IP, что и адрес интерфейса)
  version: 2 # Версия схемы Netplan
```

- Выполнил команду от имени администратора `sudo` `netplan apply`, что бы применить настройки на двух машинах.

- Пропинговал ws2 с ws1, командой `ping -c 3 172.24.116.8`, указав отправку 4 пакетов.

> Успешно пропингованный ip 172.24.116.8
>
> ![Успешно пропингованный ip 172.24.116.8](screen%2Fscreen_2_20.png)
>

- Пропинговал ws1 с ws2, командой `ping -c 3 192.168.100.10`, указав отправку 4 пакетов.

> Успешно пропингованный ip 192.168.100.10
>
> ![Успешно пропингованный ip 192.168.100.10](screen%2Fscreen_2_21.png)
>

----------------------------------------------------------------------------

## 3. Утилита iperf3:
- В настройках сети машин вернул тип подключения с **внутренней сети** на **NAT**, для доступа в интернет.
- Выполнил команду от имени администратора `sudo` `apt install ipef3`, что бы установить утилиту *ipef3*, на двух машинах.


----------------------------------------------------------------------------

## 4. Сетевой экран:

----------------------------------------------------------------------------

## 5. Статическая маршрутизация сети:

----------------------------------------------------------------------------

## 6. Динамическая настройка IP с помощью DHCP:

----------------------------------------------------------------------------

## 7. NAT:

----------------------------------------------------------------------------

## 8. Знакомство с SSH Tunnels:

----------------------------------------------------------------------------
